<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>Website X — Concierge Support (Twilio)</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet" />

  <!-- Styles modularizados -->
  <link rel="stylesheet" href="./styles/base.css" />
  <link rel="stylesheet" href="./styles/layout.css" />
  <link rel="stylesheet" href="./styles/components.css" />
  <link rel="stylesheet" href="./styles/chat.css" />
  <link rel="stylesheet" href="./styles/video.css" />
  <link rel="stylesheet" href="./styles/phone-lab.css" />
</head>
<body>
  <div class="backdrop" id="backdrop"></div>

  <div class="page">
    <aside class="sidebar" id="drawer" data-include="./partials/sidebar.html"></aside>

    <div class="content" id="contentRoot">
      <header class="topbar" data-include="./partials/topbar.html"></header>

      <main>
        <section class="hero" id="kb" aria-label="Hero" data-include="./partials/hero.html"></section>
        <section class="grid" id="chat" aria-label="Start chat" data-include="./partials/grid-start-chat.html"></section>
        <section id="chat-container" class="chat hidden" aria-live="polite" aria-label="Live chat" data-include="./partials/chat-shell.html"></section>
        <section class="grid" id="agent-portal" aria-label="Agent Portal" data-include="./partials/agent-portal.html"></section>
        <section class="grid" id="phone-lab" aria-label="Phone Lab" data-include="./partials/phone-lab.html"></section>
        <section class="grid" id="status" aria-label="Service Status" data-include="./partials/status.html"></section>
        <section class="grid" id="how" aria-label="How it works" data-include="./partials/how.html"></section>
      </main>

      <footer>
        © <span id="year"></span> Website X • Premium Support — <a href="#" style="color:var(--accent)">Privacy</a> · <a href="#" style="color:var(--accent)">Terms</a>
      </footer>
    </div>
  </div>

  <nav class="bottombar" aria-label="Bottom navigation" data-include="./partials/bottombar.html"></nav>
  <div class="fab" data-include="./partials/fab.html"></div>

  <!-- SDKs (order matters) -->
  <script src="https://media.twiliocdn.com/sdk/js/conversations/v2.4/twilio-conversations.min.js" defer></script>
  <script src="https://media.twiliocdn.com/sdk/js/video/releases/2.27.0/twilio-video.min.js" defer></script>
  <!-- Voice: ya no hay CDN oficial; usamos unpkg para v2.x -->
  <script src="https://unpkg.com/@twilio/voice-sdk@2.10.1/dist/twilio.min.js" defer></script>

  <!-- Config inicial: EXACTO al monolítico -->
  <script>
    window.API_BASE = 'http://localhost:4000';
    window.DEMO = {
      agentPortalUrl: 'https://agents.demo.example.com',
      agentId: 'demo-agent-1',
      workerSid: 'WKxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx',
      identity: 'client:agent:demo-agent-1',
      softphoneUrl: '',
      ivrNumber: '+12058275832',
      outboundFromNumber: '+19793416695',
      customerProfiles: [
        { id: 'alex', name: 'Alex Johnson', callerId: '+19793416695', scenario: 'vip', dtmf: '1-2', locale: 'en-US', notes: 'VIP · vehicle on file' },
      ]
    };
    try { document.getElementById('year').textContent = new Date().getFullYear(); } catch {}
  </script>

  <!-- Cargador de parciales y arranque -->
  <script type="module">
    async function includePartials() {
      const nodes = [...document.querySelectorAll('[data-include]')];
      await Promise.all(nodes.map(async el => {
        const res = await fetch(el.dataset.include);
        el.innerHTML = await res.text();
      }));
    }

    // 1) Inyecta parciales
    await includePartials();
    // 2) Señaliza que el DOM ya tiene TODOS los IDs necesarios
    window.__partialsReady = true;
    window.dispatchEvent(new Event('partials:ready'));
    // 3) Ahora sí: carga la app (los módulos enganchan listeners con los nodos presentes)
    await import('./app/main.js');
  </script>
</body>
</html>
